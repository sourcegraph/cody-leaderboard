 question: Where is the code that enforces the context length limit?
# CHAT
# CHAT_QUESTION Where is the code that enforces the context length limit?

# CHAT_REPLY The code that enforces the context length limit can be found in the following files:
# CHAT_REPLY 
# CHAT_REPLY 1. **`mocked/codebase_context/limit.go`**:
# CHAT_REPLY    - The functions `limitChunkMatches` and `limitLineMatches` are responsible for enforcing limits on the number of matches in file chunks and lines, respectively.
# CHAT_REPLY    ```go
# CHAT_REPLY    func limitChunkMatches(file *FileMatch, limit int) int {
# CHAT_REPLY        // Implementation details...
# CHAT_REPLY    }
# CHAT_REPLY 
# CHAT_REPLY    func limitLineMatches(file *FileMatch, limit int) int {
# CHAT_REPLY        // Implementation details...
# CHAT_REPLY    }
# CHAT_REPLY    ```
# CHAT_REPLY 
# CHAT_REPLY 2. **`cody_test/vscode/src/completions/context/context-mixer.ts`**:
# CHAT_REPLY    - The `GetContextOptions` interface includes a `maxChars` property, which is likely used to enforce the maximum number of characters for context.
# CHAT_REPLY    ```typescript
# CHAT_REPLY    interface GetContextOptions {
# CHAT_REPLY        document: vscode.TextDocument
# CHAT_REPLY        position: vscode.Position
# CHAT_REPLY        docContext: DocumentContext
# CHAT_REPLY        abortSignal?: AbortSignal
# CHAT_REPLY        maxChars: number
# CHAT_REPLY        lastCandidate?: LastInlineCompletionCandidate
# CHAT_REPLY    }
# CHAT_REPLY    ```
# CHAT_REPLY 
# CHAT_REPLY 3. **`cody_test/lib/shared/src/prompt/truncation.ts`**:
# CHAT_REPLY    - The function `truncateTextNearestLine` enforces a limit on the number of bytes for a given text.
# CHAT_REPLY    ```typescript
# CHAT_REPLY    export function truncateTextNearestLine(
# CHAT_REPLY        text: string,
# CHAT_REPLY        maxBytes: number
# CHAT_REPLY    ): { truncated: string; range?: RangeData } {
# CHAT_REPLY        // Implementation details...
# CHAT_REPLY    }
# CHAT_REPLY    ```
# CHAT_REPLY 
# CHAT_REPLY 4. **`cody_test/vscode/src/completions/providers/provider.ts`**:
# CHAT_REPLY    - The function `standardContextSizeHints` calculates and returns size hints for context, including total characters, prefix characters, and suffix characters.
# CHAT_REPLY    ```typescript
# CHAT_REPLY    export function standardContextSizeHints(maxContextTokens: number): ProviderContextSizeHints {
# CHAT_REPLY        return {
# CHAT_REPLY            totalChars: Math.floor(tokensToChars(0.9 * maxContextTokens)), // keep 10% margin for preamble, etc.
# CHAT_REPLY            prefixChars: Math.floor(tokensToChars(0.6 * maxContextTokens)),
# CHAT_REPLY            suffixChars: Math.floor(tokensToChars(0.1 * maxContextTokens)),
# CHAT_REPLY        }
# CHAT_REPLY    }
# CHAT_REPLY    ```
# CHAT_REPLY 
# CHAT_REPLY 5. **`mocked/enhanced_context/limit.go`**:
# CHAT_REPLY    - The `RateLimit` struct includes fields for limiting the number of allowed models, the limit, and the interval.
# CHAT_REPLY    ```go
# CHAT_REPLY    type RateLimit struct {
# CHAT_REPLY        AllowedModels []string `json:"allowedModels"`
# CHAT_REPLY        Limit    int64         `json:"limit"`
# CHAT_REPLY        Interval time.Duration `json:"interval"`
# CHAT_REPLY        // Other fields...
# CHAT_REPLY    }
# CHAT_REPLY    ```
# CHAT_REPLY 
# CHAT_REPLY These pieces of code collectively enforce various context length limits across different parts of the codebase.

# CONTEXT_ITEMS [{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL61-63"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL164-169"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL132-134"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/codebase_context/limit.goL129-143"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/codebase_context/limit.goL80-125"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL20-36"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL85-99"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/codebase_context/limit.goL62-76"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/services/utils/code-count.test.tsL0-57"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/services/utils/code-count.tsL0-21"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/test/e2e/code-actions.test.tsL0-73"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/commands/services/code-lenses.tsL0-203"},{"source":"search","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/mocked/enhanced_context/limit.goL138-138"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/commands/context/directory.tsL49-74"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/agent/src/AgentTextDocument.tsL91-122"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/lib/shared/src/codebase-context/messages.tsL38-88"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/lib/shared/src/token/constants.tsL0-40"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/commands/context/file-path.tsL0-43"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/commands/context/workspace.tsL22-51"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/completions/providers/fireworks.tsL175-199"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/edit/prompt/context.tsL39-61"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/completions/providers/provider.tsL27-57"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/lib/shared/src/prompt/truncation.tsL25-60"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/context/remote-search.tsL152-163"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/chat/chat-view/prompt.tsL57-80"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/chat/utils.tsL104-135"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/completions/context/retrievers/jaccard-similarity/jaccard-similarity-retriever.tsL0-22"},{"source":"embeddings","file":"/Users/jan/repos/cody-leaderboard/input/chat_context/cody_test/vscode/src/completions/context/context-mixer.tsL0-33"}]

 class: Find logic
